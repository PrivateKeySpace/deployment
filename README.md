# Private Key Space Wallet - Deployment Scripts

Deployment scripts for wallet service.

## Usage

### TL;DR

1. Set up your system:
    * install [docker](https://docs.docker.com/install/) and [docker-compose](https://docs.docker.com/compose/)
2. Set up environment:
    * with autogenerated secrets
    ```bash
    echo PKS_AUTH_SECRET=$(openssl rand -hex 32) >> .env
    echo PKS_DB_PASSWORD=$(openssl rand -hex 8) >> .env
    ```
    * *(optionally)* with custom URL if you're not running on localhost; note that port 3100 is mandatory
    ```bash
    echo PKS_API_BASE_URL=http://example.com:3100 >> .env
    ```
3. Download & run Private Key Space:
```bash
curl -sSL -o ./pks.sh \
  https://github.com/PrivateKeySpace/deployment/raw/develop/scripts/pks.sh \
  && sudo chmod u+x ./pks.sh
./pks.sh install regtest
./pks.sh start regtest
```
4. Open `http://127.0.0.1:3000/` (or `http://example.com:3000/`, if you went with custom URL on step 2; note that port 3000 is mandatory) in your browser

### Commands

Following commands, as well as configuration files and scripts in `config` directory, are available for pulling, building, pushing and running Private Key Space Wallet manually.
Makefile wraps just `docker-compose` calls and is pretty straightforward.

Preparations:
  * install [git](https://git-scm.com/)
  * install [docker](https://docs.docker.com/install/) and [docker-compose](https://docs.docker.com/compose/)
  * clone repository

Pull images from Docker Hub (must specify `FLAVOR` - flavor):
```bash
FLAVOR=demo make pull
```

Build images (must specify `FLAVOR` - flavor):
```bash
FLAVOR=regtest make build
```
This commands expects [web](https://github.com/PrivateKeySpace/web) and [core](https://github.com/PrivateKeySpace/core) repositories to be cloned at the same path as this repository and uses active branches from both to build containers.

Push built images to Docker Hub (must specify `FLAVOR` - flavor):
```bash
FLAVOR=regtest make push
```

Run built/pulled images (must specify `FLAVOR` - flavor, `PKS_AUTH_SECRET` - authentication secret, `PKS_DB_PASSWORD` - database password):
```bash
PKS_AUTH_SECRET=$(openssl rand -hex 32) PKS_DB_PASSWORD=$(openssl rand -hex 8) FLAVOR=regtest make run
```
Example uses [openssl](https://www.openssl.org/) to generate secret and password. 
We strongly recommend to save them in secure location to be able to relaunch the application in future.
View the values:
```bash
env | grep PKS
```

By default, [web](https://github.com/PrivateKeySpace/web) launches at `http://127.0.0.1:3000/`
and expects [core](https://github.com/PrivateKeySpace/core) to be launched at `http://127.0.0.1:3100/`.
You can tweak this by running:
```bash
export PKS_API_BASE_URL=http://example.com:3100
```
Ports 3000 and 3100 are mandatory and can not be tweaked. Use outer proxy server to route to 80, 443 or any other desired ports.
